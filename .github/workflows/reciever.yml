name: Reciever of the release

on:
  schedule:
    - cron: "* * * * *"

jobs:
  transport:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    # 下载API文件
    - name: Download File To Workspace
      uses: carlosperate/download-file-action@v1.0.3
      with:
        # URL of the file to download
        file-url: https://api.github.com/repos/advancedfx/advancedfx/releases/latest
        # New filename to rename the downloaded file
        file-name: release.json
        #location: # optional, default is .

    # 运行工具
    - name: Run Repo-Tranporter
      run: |
        ls -al
        chmod 777 repo-transporter
        ./repo-transporter
        ls -al
        
    - name: push
      uses: github-actions-x/commit@v2.6
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        push-branch: master
        commit-message: 'Automatically pushed by GitHub Actions'
        rebase: 'true' # pull abd rebase before commit
        force-add: 'true'
        name: Purple-CSGO
        email: 438518244@qq.com
    
    - name: dir
      run: |
        ls -al
        
    # 等待30s 以防先发布再push
    - name: Sleep for 30 seconds
      uses: jakejarvis/wait-action@master
      with:
        time: '30s'

    # 获取原仓库的版本
    - name: Get Latest HLAE Tag
    # ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
      uses: actions-hub/watch-tag@master
      with:
        provider: github
        repository: advancedfx/advancedfx
        env_name: LATEST_HLAE_TAG
    
    - name: dir
      run: |
        ls -al
    
    - name: Github Release create, update, and upload assets
      # You may pin to the exact commit or the version.
      # uses: meeDamian/github-release@7ae19492500104f636b3fee4d8103af0fed36c8e
      uses: meeDamian/github-release@v2.0.3
      env:
        TAG: 'v${{ env.LATEST_HLAE_TAG }}'
      with:
        # Github API token to be used. Quite unavoidable, I'm afraid.
        token:  ${{ secrets.GITHUB_TOKEN }}
        # A tag for the release. Required UNLESS action is run on tag push (meaning: '$GITHUB_REF' contains 'ref/tag/<TAG>').
    
        tag: ${{ env.TAG }}
        # Name the release, the more creative, the better.
        name: ${{ env.TAG }}
        # Longer description of the release, ex. changelog, or info about contributors.
        body: This release is automatically made by GitHub Actions
